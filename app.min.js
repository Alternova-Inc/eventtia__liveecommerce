function getParsedDates(e,t){let n=e.substring(0,10).split("-"),a=e.substring(e.length-8,e.length).split(":");a.pop();let s=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(a[0]),parseInt(a[1]),0,0),i=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(a[0]),parseInt(a[1]),0,0),d=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(a[0]),parseInt(a[1]),0,0),l=new Date,c=l.getTimezoneOffset()/-60;i.setHours(i.getHours()+c),d.setHours(d.getHours()+c),d.setMinutes(d.getMinutes()+parseInt(t));let r=i.getFullYear(),o=i.getMonth(),_=i.getDate();_<10&&(_="0"+_);let u=i.getHours();u<10&&(u="0"+u);let m=i.getMinutes();m<10&&(m="0"+m);let v=s.getDay(),p=french_week_days[v]+" "+_+" "+french_months[o];p+=" "+r+", "+u+":"+m;let g={event_time_finished:d,event_time_user_adjusted:i,readable_date:p,original_event_date:n.join("-")+" "+a[0]+"-"+a[1]};return g}function gen_uuid(){(async function(){const{data:e,error:t}=await supabase.from("id_gen").insert([{user_id:user_id}]);t?(console.log("Error creating UUID:"),console.log(t)):(db_id=e[0].id,current_utc_time=e[0].created_at,localStorage.setItem("eventtia-tag",db_id))})()}function check_event_status(e,t){let n="Commencera bientôt",a="scheduled-status",s="scheduled-status";"Commencera bientôt"==n?s="scheduled-status":"Rediffusion"==n?s="replay-status":"Live"==n?s="live-status":console.log("Status not supported.");let i=new Date;i<t?(n="Commencera bientôt",a="scheduled-status"):i>e?(n="Rediffusion",a="replay-status"):(n="Live",a="live-status");let d={event_status:n,status_class_add:a,status_class_remove:s};return d}function organizeDataFromSupabase(e){let t={},n={};for(let a=0;a<e.length;a++)event_key=e[a].id,t[event_key]=e[a],n[event_key]=getParsedDates(t[event_key].event_datetime,t[event_key].event_duration_mins);let a={events_data:t,parsed_dates:n};return a}function updateLayoutFromData(e){const t=e.events_data,n=e.parsed_dates;let a={},s="";for(let e=0;e<event_ids.length;e++)if(s=event_ids[e].id,a=check_event_status(n[s].event_time_finished,n[s].event_time_user_adjusted),"expand"===t[s].widget_type){let e=document.getElementById(s);e.innerHTML='<ul class="eventtia-cards-expand">\n<li class="eventtia-cards-expand_item">\n<div class="eventtia-card-expand">\n<div class="eventtia-card-expand_image">\n<img class="eventtia-card-expand_img" src="'+t[s].widget_image+'">\n</div>\n<div class="eventtia-card-expand_content">\n<p class="eventtia-card-expand_badge">\n'+a.event_status+'\n</p>\n<h5 class="eventtia-card-expand_date">\n'+n[s].readable_date+'\n</h5>\n<h2 class="eventtia-card-expand_title">\n'+t[s].widget_title_text+'\n</h2>\n<p class="eventtia-card-expand_text">\n'+t[s].widget_description_text+'\n</p>\n<div class="eventtia-card-expand_button">\n<button class="eventtia-card-expand_btn eventtia-btn" eventtia-id="'+s+'">\n'+t[s].widget_button_text+"\n</button>\n</div>\n</div>\n</div>\n</li>\n</ul>\n",document.getElementsByClassName("eventtia-card-expand_badge")[0].innerHTML=a.event_status+"\n",document.getElementsByClassName("eventtia-card-expand_badge")[0].classList.remove(a.status_class_remove),document.getElementsByClassName("eventtia-card-expand_badge")[0].classList.add(a.status_class_add),document.getElementsByClassName("eventtia-card-expand_btn")[0].classList.remove(a.status_class_remove),document.getElementsByClassName("eventtia-card-expand_btn")[0].classList.add(a.status_class_add)}else if("compact"===t[s].widget_type){let e=document.getElementById(s);e.setAttribute("style","display: inline;"),e.innerHTML='<ul class="eventtia-cards-compact">\n<li class="eventtia-cards-compact_item">\n<div class="eventtia-card-compact">\n<div class="eventtia-card-compact_image">\n<img class="eventtia-card-compact_img" src="'+t[s].widget_image+'">\n</div>\n<div class="eventtia-card-compact_content">\n<p class="eventtia-card-compact_badge">\n'+a.event_status+'\n</p>\n<h2 class="eventtia-card-compact_title">\n'+t[s].widget_title_text+'\n</h2>\n<div class="eventtia-card-compact_button">\n<button class="eventtia-card-compact_btn eventtia-btn" eventtia-id="'+s+'">\n'+t[s].widget_button_text+"\n</button>\n</div>\n</div>\n</div>\n</li>\n</ul>\n",document.getElementsByClassName("eventtia-card-compact_badge")[0].innerHTML=a.event_status+"\n",document.getElementsByClassName("eventtia-card-compact_badge")[0].classList.remove(a.status_class_remove),document.getElementsByClassName("eventtia-card-compact_badge")[0].classList.add(a.status_class_add),document.getElementsByClassName("eventtia-card-compact_btn")[0].classList.remove(a.status_class_remove),document.getElementsByClassName("eventtia-card-compact_btn")[0].classList.add(a.status_class_add)}else if("button"===t[s].widget_type){let e=document.getElementById(s);e.setAttribute("style","display: inline;"),e.innerHTML='<button class="eventtia-card-compact_btn eventtia-btn replay-status" eventtia-id="'+s+'">'+t[s].widget_button_text+"</button>"}else console.log("Unrecognized widget type")}function update_session(e,t,n,a,s){"none"!=db_id&&async function(){const{data:i,error:d}=await supabase.from("sessions").insert([{session_id:db_id,url:n,action:e,status:a,event_date:s,interaction_id:t}],{returning:"minimal"});d?(console.log("Error saving in Supabase:"),console.log(d)):("close"==e&&clearInterval(interval),"open"==e&&(interval=setInterval(function(){update_session("update",interaction_id_js,n,a,s)},6e4)))}()}let params=document.getElementById("eventtia-library").src;const french_months=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"],french_week_days=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];scriptStyle=document.getElementById("eventtia-library").setAttribute("style","display: inline;");let params_array=params.split("?");const elements_array=[];for(let e=0;e<params_array.length;e++)elements_array.push(params_array[e].split("="));let env=null;env="env"===elements_array[elements_array.length-1][0]?"dev":"prod";const event_ids=document.getElementsByClassName("eventtia-card-content"),{createClient:createClient}=supabase;let host=null,key=null;"prod"===env?(host="https://fmsesqjkbadnliholapv.supabase.co",key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxMzc1NDgxNCwiZXhwIjoxOTI5MzMwODE0fQ.7Qi89BzXqzlBlAQWbLQ0CKJi70s0zPMjKeFUrdMgJFc"):(host="https://grjotsrqxlcjdhqqjmai.supabase.co",key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxMzQyMDc0MiwiZXhwIjoxOTI4OTk2NzQyfQ.CtO-mvBItlH_chUShrE_CgDjoQ9llWiUa7WNsdCNsXY"),supabase=createClient(host,key);let db_id="none",user_id="8baf6150-aee1-43eb-8bdb-451c723dbf21",interval=null,current_utc_time=null,getPublicEvent=async function(e){const{data:t,error:n}=await supabase.from("public_events").select().filter("id","eq",e);return n?Promise.reject(n):Promise.resolve(t[0])};null===localStorage.getItem("eventtia-tag")?gen_uuid():db_id=localStorage.getItem("eventtia-tag");let interaction_id_js=0,modal=null,modalContent=null,span=null,embed=null,event_key=null,btn=document.getElementsByClassName("eventtia-btn"),div=document.createElement("div");div.setAttribute("id","eventtia-modal-div"),document.body.appendChild(div);for(let e=0;e<event_ids.length;e++)event_key=event_ids[e].id,div.innerHTML+='<div id="modal-'+event_key+'" class="modal-embed">\n<div id="modalcontent-'+event_key+'" class="modal-content">\n<span class="close-btn" eventtia-id="'+event_key+'">&times;</span>\n<embed id="embed-'+event_key+'" class="embed-modal" width="100%" height="100%" src="">\n</div>\n</div>\n',modal=document.getElementById("modal-"+event_key),modal.setAttribute("style","display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto;  overflow: hidden"),modalContent=document.getElementById("modalcontent-"+event_key),modalContent.setAttribute("style","margin: auto; padding: 0px;"),embed=document.getElementById("embed-"+event_key),embed.setAttribute("style","height: calc(100vh - 55px);");spans=document.getElementsByClassName("close-btn");let container_promises=[];for(let e=0;e<event_ids.length;e++)event_key=event_ids[e].id,container_promises.push(getPublicEvent(event_key));Promise.all(container_promises).then(function(e){let t=organizeDataFromSupabase(e);updateLayoutFromData(t);setInterval(function(){check_event_status()},6e4);let n=null,a=null,s=null;for(let e=0;e<btn.length;e++)btn[e].onclick=function(){n=btn[e].getAttribute("eventtia-id"),a=t.events_data[n],s=t.parsed_dates[n],document.getElementById("embed-"+n).src=a.url,document.getElementById("modal-"+n).style.display="block",interaction_id_js=Date.now();let i=check_event_status(s.event_time_finished,s.event_time_user_adjusted);update_session("open",interaction_id_js,a.url,i.status_class_add,s.original_event_date)};for(let e=0;e<spans.length;e++)spans[e].setAttribute("style","float: right; margin: 10px; font-weight: bold; cursor: pointer;"),spans[e].onclick=function(){n=btn[e].getAttribute("eventtia-id"),a=t.events_data[n],s=t.parsed_dates[n],document.getElementById("modal-"+n).style.display="none";let i=check_event_status(s.event_time_finished,s.event_time_user_adjusted);update_session("close",interaction_id_js,a.url,i.status_class_add,s.original_event_date)}}).catch(function(e){console.log("Error reading Public Events:"),console.log(e)});