function getParsedDates(e,t){let n=e.substring(0,10).split("-"),a=e.substring(e.length-8,e.length).split(":");a.pop();new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(a[0]),parseInt(a[1]),0,0);let s=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(a[0]),parseInt(a[1]),0,0),i=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]),parseInt(a[0]),parseInt(a[1]),0,0),d=new Date,l=d.getTimezoneOffset()/-60;s.setHours(s.getHours()+l),i.setHours(i.getHours()+l),i.setMinutes(i.getMinutes()+parseInt(t));let r=s.getFullYear(),o=s.getMonth(),c=s.getDate();c<10&&(c="0"+c);let _=s.getHours();_<10&&(_="0"+_);let u=s.getMinutes();u<10&&(u="0"+u);let m=s.getDay(),v=french_week_days[m]+" "+c+" "+french_months[o];v+=" "+r+", "+_+":"+u;let p={event_time_finished:i,event_time_user_adjusted:s,readable_date:v,original_event_date:n.join("-")+" "+a[0]+"-"+a[1]};return p}function gen_uuid(){(async function(){const{data:e,error:t}=await supabase.from("id_gen").insert([{user_id:user_id}]);t?(console.log("Error creating UUID:"),console.log(t)):(db_id=e[0].id,current_utc_time=e[0].created_at,localStorage.setItem("eventtia-tag",db_id))})()}function check_event_status(e,t,n,a,s){let i="Commencera bientôt",d="scheduled-status",l="scheduled-status",r=null;s||(r=document.getElementById(n),"expand"===a?l=r.getElementsByClassName("eventtia-card-expand_badge")[0].classList[1]:"compact"===a&&(l=r.getElementsByClassName("eventtia-card-compact_badge")[0].classList[1]));let o=new Date;o<t?(i="Commencera bientôt",d="scheduled-status"):o>e?(i="Rediffusion",d="replay-status"):(i="Live",d="live-status");let c={event_status:i,status_class_add:d,status_class_remove:l};return c}function organizeDataFromSupabase(e){let t={},n={};for(let a=0;a<e.length;a++)event_key=e[a].id,t[event_key]=e[a],n[event_key]=getParsedDates(t[event_key].event_datetime,t[event_key].event_duration_mins);let a={events_data:t,parsed_dates:n};return a}function editCardClasses(e,t,n,a){let s=e.getElementsByClassName(t)[0],i=e.getElementsByClassName(n)[0];s.innerHTML=a.event_status+"\n",s.classList.remove(a.status_class_remove),s.classList.add(a.status_class_add),i.classList.remove(a.status_class_remove),i.classList.add(a.status_class_add)}function updateLayoutFromData(e,t,n,a){if("expand"===e.widget_type){let s=document.getElementById(e.id);a&&(s.innerHTML='<ul class="eventtia-cards-expand">\n<li class="eventtia-cards-expand_item">\n<div class="eventtia-card-expand">\n<div class="eventtia-card-expand_image">\n<img class="eventtia-card-expand_img" src="'+e.widget_image+'">\n</div>\n<div class="eventtia-card-expand_content">\n<p class="eventtia-card-expand_badge">\n'+n.event_status+'\n</p>\n<h5 class="eventtia-card-expand_date">\n'+t.readable_date+'\n</h5>\n<h2 class="eventtia-card-expand_title">\n'+e.widget_title_text+'\n</h2>\n<p class="eventtia-card-expand_text">\n'+e.widget_description_text+'\n</p>\n<div class="eventtia-card-expand_button">\n<button class="eventtia-card-expand_btn eventtia-btn" eventtia-id="'+e.id+'">\n'+e.widget_button_text+"\n</button>\n</div>\n</div>\n</div>\n</li>\n</ul>\n"),editCardClasses(s,"eventtia-card-expand_badge","eventtia-card-expand_btn",n)}else if("compact"===e.widget_type){let t=document.getElementById(e.id);a&&(t.setAttribute("style","display: inline;"),t.innerHTML='<ul class="eventtia-cards-compact">\n<li class="eventtia-cards-compact_item">\n<div class="eventtia-card-compact">\n<div class="eventtia-card-compact_image">\n<img class="eventtia-card-compact_img" src="'+e.widget_image+'">\n</div>\n<div class="eventtia-card-compact_content">\n<p class="eventtia-card-compact_badge">\n'+n.event_status+'\n</p>\n<h2 class="eventtia-card-compact_title">\n'+e.widget_title_text+'\n</h2>\n<div class="eventtia-card-compact_button">\n<button class="eventtia-card-compact_btn eventtia-btn" eventtia-id="'+e.id+'">\n'+e.widget_button_text+"\n</button>\n</div>\n</div>\n</div>\n</li>\n</ul>\n"),editCardClasses(t,"eventtia-card-compact_badge","eventtia-card-compact_btn",n)}else if("button"===e.widget_type){let t=document.getElementById(e.id);a&&(t.setAttribute("style","display: inline;"),t.innerHTML='<button class="eventtia-card-button_btn eventtia-btn" eventtia-id="'+e.id+'">'+e.widget_button_text+"\n</button>")}else console.log("Unrecognized widget type")}function generalLayoutUpdate(e,t,n){let a=t.events_data[e],s=t.parsed_dates[e],i=check_event_status(s.event_time_finished,s.event_time_user_adjusted,e,a.widget_type,n);return updateLayoutFromData(a,s,i,n),[i,s,a]}function update_session(e,t,n,a){if("none"!=db_id){let s=generalLayoutUpdate(a,n,!1),i=s[0],d=s[1],l=s[2];(async function(){const{data:s,error:r}=await supabase.from("sessions").insert([{session_id:db_id,url:l.url,action:e,status:i.status_class_add,event_date:d.original_event_date,interaction_id:t}],{returning:"minimal"});r?(console.log("Error saving in Supabase:"),console.log(r)):("close"==e&&clearInterval(intervals_obj[a]),"open"==e&&(intervals_obj[a]=setInterval(function(){update_session("update",interaction_id_js,n,a)},6e4)))})()}}let params=document.getElementById("eventtia-library").src;const french_months=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Décembre"],french_week_days=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];scriptStyle=document.getElementById("eventtia-library").setAttribute("style","display: inline;");let params_array=params.split("?");const elements_array=[];for(let e=0;e<params_array.length;e++)elements_array.push(params_array[e].split("="));let env=null;elements_array.length>0?"env"===elements_array[elements_array.length-1][0]&&(env="dev"):env="prod";const event_ids=document.getElementsByClassName("eventtia-card-content"),{createClient:createClient}=supabase;let host=null,key=null;"prod"===env?(host="https://fmsesqjkbadnliholapv.supabase.co",key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxMzc1NDgxNCwiZXhwIjoxOTI5MzMwODE0fQ.7Qi89BzXqzlBlAQWbLQ0CKJi70s0zPMjKeFUrdMgJFc"):(host="https://grjotsrqxlcjdhqqjmai.supabase.co",key="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYxMzQyMDc0MiwiZXhwIjoxOTI4OTk2NzQyfQ.CtO-mvBItlH_chUShrE_CgDjoQ9llWiUa7WNsdCNsXY"),supabase=createClient(host,key);let db_id="none",user_id="8baf6150-aee1-43eb-8bdb-451c723dbf21",intervals_obj={},current_utc_time=null,getPublicEvent=async function(e){const{data:t,error:n}=await supabase.from("public_events").select().filter("id","eq",e);return n?Promise.reject(n):Promise.resolve(t[0])};null===localStorage.getItem("eventtia-tag")?gen_uuid():db_id=localStorage.getItem("eventtia-tag");let interaction_id_js=0,modal=null,modalContent=null,span=null,embed=null,event_key=null,btn=document.getElementsByClassName("eventtia-btn"),div=document.createElement("div");div.setAttribute("id","eventtia-modal-div"),document.body.appendChild(div);for(let e=0;e<event_ids.length;e++)event_key=event_ids[e].id,div.innerHTML+='<div id="modal-'+event_key+'" class="modal-embed">\n<div id="modalcontent-'+event_key+'" class="modal-content">\n<span class="close-btn" eventtia-id="'+event_key+'">&times;</span>\n<embed id="embed-'+event_key+'" class="embed-modal" width="100%" height="100%" src="">\n</div>\n</div>\n',modal=document.getElementById("modal-"+event_key),modal.setAttribute("style","display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto;  overflow: hidden"),modalContent=document.getElementById("modalcontent-"+event_key),modalContent.setAttribute("style","margin: auto; padding: 0px;"),embed=document.getElementById("embed-"+event_key),embed.setAttribute("style","height: calc(100vh - 55px);");spans=document.getElementsByClassName("close-btn");let container_promises=[];for(let e=0;e<event_ids.length;e++)event_key=event_ids[e].id,container_promises.push(getPublicEvent(event_key));Promise.all(container_promises).then(function(e){let t=organizeDataFromSupabase(e),n={};for(let e=0;e<event_ids.length;e++){let a=event_ids[e].id;generalLayoutUpdate(a,t,!0),n[a]=setInterval(function(){generalLayoutUpdate(a,t,!1)},6e4)}for(let e=0;e<btn.length;e++)btn[e].onclick=function(){let n=btn[e].getAttribute("eventtia-id");document.getElementById("embed-"+n).src=t.events_data[n].url+"?email="+t.events_data[n].event_access_email,document.getElementById("modal-"+n).style.display="block",interaction_id_js=Date.now(),update_session("open",interaction_id_js,t,n)};for(let e=0;e<spans.length;e++)spans[e].setAttribute("style","float: right; margin: 10px; font-weight: bold; cursor: pointer;"),spans[e].onclick=function(){let n=btn[e].getAttribute("eventtia-id");document.getElementById("modal-"+n).style.display="none",update_session("close",interaction_id_js,t,n)}}).catch(function(e){console.log("Error reading Public Events:"),console.log(e)});